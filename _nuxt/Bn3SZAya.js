import{$ as E,r as y,a0 as b,G as _,L as S,a1 as A,_ as $,d as j,g as O,U as J,S as p,o as B,c as F,A as Y,a2 as M}from"./Dhgs_AmC.js";import{n as P,t as U,i as V}from"./CZK_Uoeq.js";function W(e,r,a){let i;E(a)?i={evaluating:a}:i=a||{};const{lazy:n=!1,evaluating:u=void 0,shallow:d=!0,onError:c=P}=i,o=y(!n),t=d?b(r):y(r);let s=0;return _(async l=>{if(!o.value)return;s++;const m=s;let v=!1;u&&Promise.resolve().then(()=>{u.value=!0});try{const f=await e(g=>{l(()=>{u&&(u.value=!1),v||g()})});m===s&&(t.value=f)}catch(f){c(f)}finally{u&&m===s&&(u.value=!1),v=!0}}),n?S(()=>(o.value=!0,t.value)):t}function X(e){var r;const a=U(e);return(r=a==null?void 0:a.$el)!=null?r:a}const h=new Map;function x(e){const r=A();function a(c){var o;const t=h.get(e)||new Set;t.add(c),h.set(e,t);const s=()=>n(c);return(o=r==null?void 0:r.cleanups)==null||o.push(s),s}function i(c){function o(...t){n(o),c(...t)}return a(o)}function n(c){const o=h.get(e);o&&(o.delete(c),o.size||u())}function u(){h.delete(e)}function d(c,o){var t;(t=h.get(e))==null||t.forEach(s=>s(c,o))}return{on:a,once:i,off:n,emit:d,reset:u}}class w extends Error{constructor(r){super(r),this.message=r,Object.setPrototypeOf(this,w.prototype)}}const z=j({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:r,emit:a}){const i=x(`form-${V()}`);O(()=>{i.on(async t=>{var s;t.type!=="submit"&&((s=e.validateOn)!=null&&s.includes(t.type))&&await c(t.path,{silent:!0})})}),J(()=>{i.reset()});const n=y([]);p("form-errors",n),p("form-events",i);const u=y({});p("form-inputs",u);async function d(){let t=await e.validate(e.state);if(e.schema)if(G(e.schema))t=t.concat(await L(e.state,e.schema));else if(C(e.schema))t=t.concat(await q(e.state,e.schema));else if(N(e.schema))t=t.concat(await H(e.state,e.schema));else if(I(e.schema))t=t.concat(await K(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function c(t,s={silent:!1}){let l=t;if(t&&!Array.isArray(t)&&(l=[t]),l){const m=n.value.filter(f=>!l.includes(f.path)),v=(await d()).filter(f=>l.includes(f.path));n.value=m.concat(v)}else n.value=await d();if(!s.silent&&n.value.length>0)throw new w(`Form validation failed: ${JSON.stringify(n.value,null,2)}`);return e.state}async function o(t){var l;const s=t;try{(l=e.validateOn)!=null&&l.includes("submit")&&await c();const m={...s,data:e.state};a("submit",m)}catch(m){if(!(m instanceof w))throw m;const v={...s,errors:n.value.map(f=>({...f,id:u.value[f.path]}))};a("error",v)}}return r({validate:c,errors:n,setErrors(t,s){n.value=t,s?n.value=n.value.filter(l=>l.path!==s).concat(t):n.value=t},async submit(){await o(new Event("submit"))},getErrors(t){return t?n.value.filter(s=>s.path===t):n.value},clear(t){t?n.value=n.value.filter(s=>s.path!==t):n.value=[]}}),{onSubmit:o}}});function C(e){return e.validate&&e.__isYupSchema__}function Z(e){return e.inner!==void 0}async function q(e,r){try{return await r.validate(e,{abortEarly:!1}),[]}catch(a){if(Z(a))return a.inner.map(i=>({path:i.path??"",message:i.message}));throw a}}function G(e){return e.parse!==void 0}async function L(e,r){const a=await r.safeParseAsync(e);return a.success===!1?a.error.issues.map(i=>({path:i.path.join("."),message:i.message})):[]}function N(e){return e.validateAsync!==void 0&&e.id!==void 0}function D(e){return e.isJoi===!0}async function H(e,r){try{return await r.validateAsync(e,{abortEarly:!1}),[]}catch(a){if(D(a))return a.details.map(i=>({path:i.path.join("."),message:i.message}));throw a}}function I(e){return e._parse!==void 0}async function K(e,r){const a=await r._parse(e);return a.issues?a.issues.map(i=>{var n;return{path:((n=i.path)==null?void 0:n.map(u=>u.key).join("."))||"",message:i.message}}):[]}function Q(e,r,a,i,n,u){return B(),F("form",{onSubmit:r[0]||(r[0]=M((...d)=>e.onSubmit&&e.onSubmit(...d),["prevent"]))},[Y(e.$slots,"default")],32)}const k=$(z,[["render",Q]]);export{k as _,W as c,X as u};
